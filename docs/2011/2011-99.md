---
date: 2011-02-24
title: 为nutz添加tiles视图
---


<p>公司的项目使用struts1，这时我接触到了tiles，这个页面增强布局框架，使用了将近半年，感觉良好。最近有一个个人项目我采用nutz，感到只用jsp太麻烦，于是想将tiles整合进来。tiles一般是和struts这样的框架整合的例子多，单独用的几乎没有。于是狠下心去看tiles的主页，终于有了收获，用了一下午加一晚上终于跑通了例子，并将nutzView写好了<br /><br />首先我使用了tiles2.2，去官网下载 bin包。<br />解压后，选取 tiles-jsp,tiles-core,tiles-servlet,tiles-api,<br />slf4j-api,slf4j-log4j12,conmmons-beanutils,commons-digester,commons-logging,jcl-over-slf4j,log4j这些jar，copy到 lib下。<br />然后</p> &nbsp; <pre name="code" class="java">public class TestTileFactory extends BasicTilesContainerFactory {	    @Override	    protected List&lt;URL&gt; getSourceURLs(TilesApplicationContext applicationContext,	            TilesRequestContextFactory contextFactory) {	        List&lt;URL&gt; urls = new ArrayList&lt;URL&gt;();	        try {	            urls.add(applicationContext.getResource(&quot;/WEB-INF/tiles-defs.xml&quot;));	        } catch (IOException e) {	            throw new DefinitionsFactoryException(	                    &quot;Cannot load definition URLs&quot;, e);	        }	        return urls;	    }}  </pre> <p>&nbsp;&nbsp;再添加 类</p> <p>&nbsp;&nbsp;<span style="white-space: pre;">public class TestTilesListener extends AbstractTilesListener {</span></p> <pre name="code" class="java">	    @Override	    protected TilesInitializer createTilesInitializer() {	        return new TestTilesListenerInitializer();	    }	    private static class TestTilesListenerInitializer extends AbstractTilesInitializer {	        @Override	        protected AbstractTilesContainerFactory createContainerFactory(	                TilesApplicationContext context) {	            return new TestTileFactory();	        }	    }}</pre> <p>&nbsp;在web.xml中添加配置&nbsp;</p> <p>&nbsp;<span style="white-space: pre;">&lt;listener&gt;</span></p> <pre name="code" class="java">  		&lt;listener-class&gt;com.sh169.util.TestTilesListener&lt;/listener-class&gt;  &lt;/listener&gt;</pre> <p>&nbsp;然后是，添加nutz的view</p> <p>&nbsp;下面是代码</p> <p>&nbsp;<span style="white-space: pre;">public class TilesView implements View{</span></p> <pre name="code" class="java">	private String viewName;		public TilesView(){}	public TilesView(String viewName){		this.viewName = viewName;	}	@SuppressWarnings(&quot;deprecation&quot;)	@Override	public void render(HttpServletRequest req, HttpServletResponse resp,			Object obj) throws Throwable {		req.setAttribute(&quot;obj&quot;, obj);		TilesContainer tc = TilesAccess.getContainer(req.getSession().getServletContext());		tc.render(viewName, req,resp);	}}public TilesViewMaker(){}	@Override	public View make(Ioc ioc, String type, String value) {		if(&quot;tiles&quot;.equalsIgnoreCase(type))			return new TilesView(value);		return null;	}</pre> <p>&nbsp;</p> <p>&nbsp;使用时添加 @ok(&quot;tiles:yourdefname&quot;)即可</p> <p>&nbsp;</p> <p>使用感受：引用的jar包太多了，精简到4个比较能接受，还有这是2.1中的例子，在2.2中tilesAccess中的 getContainer方法被提示不可用，应该有其他方法可以替代，以后有时间研究下 tiles的源码，自己整理成一个jar包，这样引用比较方便</p> <p>我感觉包这样划分比较好，tile-core，tile-jsp，tile-freemarker，依次类推。这样使用起来将会很方便，而且logger也应该写一个logger类，替代common-logging的功能，这样能少引用几个类。</p> <p>好了要睡觉了，剩下的明天再研究。</p>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>gae 数据存储区说明 2</title>
  
    <meta name="author" content="盒子">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css" type="text/css" rel="stylesheet" media="all">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="/assets/twitter/javascripts/qrcode.js"></script>
 

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="/">韭菜盒子</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
     
              


   <li class="nav-item">
        <a class="nav-link" href="/archive">归档</a>
      </li>


      
              


   <li class="nav-item">
        <a class="nav-link" href="/tags">标签</a>
      </li>


      
              


   <li class="nav-item">
        <a class="nav-link" href="/categories">分类</a>
      </li>


      
              


   <li class="nav-item">
        <a class="nav-link" href="/pages">分页</a>
      </li>


      
              


   <li class="nav-item">
        <a class="nav-link" href="/about">关于我</a>
      </li>


      
    </ul>
  </div>
</nav>
    <div class="container">
        <div class="page-header">
  <h1>gae 数据存储区说明 2 </h1>
</div>

<div class="row">
  <div class="span8">
    <p><p><span style="font-family: Helvetica, Arial, sans-serif; font-size: small;"> </span></p> <h2 id="Serializable_Objects">Serializable 对象</h2> <p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">字段值可以包含一个 Serializable 类的实例，将该实例的序列化值存储在 Blob 类型的单个属性值中。要告知 JDO 序列化该值，该字段需要使用&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">@Persistent(serialized=true)</code>&nbsp;批注。Blob 值未被编入索引，且无法在过滤条件或排序顺序中使用。</p> <p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">以下是一个简单的 Serializable 类示例，它代表一个文件，其中包括文件内容、文件名和 MIME 类型。这不是一个 JDO 数据类，因此没有持久批注。</p> <pre class="prettyprint"><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> java</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">io</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Serializable</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">public</span><span class="pln" style="color: #000000;"> </span><span class="kwd" style="color: #000088;">class</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">DownloadableFile</span><span class="pln" style="color: #000000;"> </span><span class="kwd" style="color: #000088;">implements</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">Serializable</span><span class="pln" style="color: #000000;"> </span><span class="pun" style="color: #666600;">{</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="kwd" style="color: #000088;">byte</span><span class="pun" style="color: #666600;">[]</span><span class="pln" style="color: #000000;"> content</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">String</span><span class="pln" style="color: #000000;"> filename</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">String</span><span class="pln" style="color: #000000;"> mimeType</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="com" style="color: #880000;">// &hellip; accessors &hellip;</span><span class="pln" style="color: #000000;"></span><span class="pun" style="color: #666600;">}</span></pre> <p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">要将 Serializable 类的实例作为 Blob 值存储在属性中，请声明一个类型为该类的字段，并使用&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">@Persistent(serialized = &quot;true&quot;)</code>&nbsp;批注：</p> <pre class="prettyprint"><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Persistent</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">DownloadableFile</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="com" style="color: #880000;">// &hellip;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@Persistent</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">serialized </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="str" style="color: #008800;">&quot;true&quot;</span><span class="pun" style="color: #666600;">)</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">DownloadableFile</span><span class="pln" style="color: #000000;"> file</span><span class="pun" style="color: #666600;">;</span></pre> <pre class="prettyprint"><span class="pun" style="color: #666600;"><span style="color: #000000; font-family: Helvetica, Arial, sans-serif; line-height: normal; white-space: normal; font-size: small;"><h2 id="Child_Objects_and_Relationships"></h2><h2 id="Child_Objects_and_Relationships">子对象和关系</h2><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">作为&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">@PersistenceCapable</code>&nbsp;类的实例的字段值在两个对象之间创建自有的一对一关系。作为此类引用的集合的字段创建自有的一对多关系。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;"><strong>重要信息：</strong>自有的关系具有事务、实体组和级联删除的隐含意义。有关详细信息，请参阅<a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/transactions.html">事务</a>和<a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/relationships.html">关系</a>。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">&nbsp;</p><h2 id="Embedded_Classes">嵌入类</h2><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">通过嵌入类，您可以使用类来建模字段值，无需创建新的数据存储区实体并形成关系。该对象值的字段直接存储在含有对象的数据存储区实体中。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">任何&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">@PersistenceCapable</code>&nbsp;数据类都可用作另一个数据类中的嵌入对象。类的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">@Persistent</code>&nbsp;字段嵌入到对象中。如果让类嵌入<code style="font-family: monospace; color: #007000; font-size: 10pt;">@EmbeddedOnly</code>&nbsp;批注，则该类只能用作嵌入类。嵌入类不需要主键字段，因为它不作为单独的实体存储。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">嵌入类的字段作为实体上的属性存储，使用每个字段的名称以及对应属性的名称。如果类型为嵌入类的对象上有多个字段，则必须重命名这些字段以使它们不会互相冲突。您可以使用&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">@Embedded</code>&nbsp;批注的参数来指定新的字段名称。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">&nbsp;</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">类似地，对象上的字段不可以使用与嵌入类的字段冲突的名称，除非重命名嵌入的字段。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">因为嵌入类的持久属性存储在与其他字段相同的实体上，所以您可以在 JDOQL 查询过滤条件和排序顺序中使用嵌入类的持久字段。您可以使用外部字段的名称、点 (<code style="font-family: monospace; color: #007000; font-size: 10pt;">.</code>) 以及嵌入字段的名称来引用嵌入字段。不管是否使用&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">@Column</code>&nbsp;批注更改了嵌入字段的属性名称，这都同样适用。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">&nbsp;</p><h2 id="Collections">集合</h2><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">一个数据存储区属性可以具有多个值。在 JDO 中，这是通过集合类型的单一字段来表示的，其中集合为核心值类型之一或 Serializable 类。支持以下集合类型：</p>   <ul style="margin-top: 0.5em; margin-right: 0px; margin-bottom: 0px; margin-left: 15px; line-height: 16px; padding: 0px;">    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">java.util.ArrayList&lt;&hellip;&gt;</code></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">java.util.HashSet&lt;&hellip;&gt;</code></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">java.util.LinkedHashSet&lt;&hellip;&gt;</code></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">java.util.LinkedList&lt;&hellip;&gt;</code></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">java.util.List&lt;&hellip;&gt;</code></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">java.util.Set&lt;&hellip;&gt;</code></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">java.util.SortedSet&lt;&hellip;&gt;</code></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">java.util.Stack&lt;&hellip;&gt;</code></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">java.util.TreeSet&lt;&hellip;&gt;</code></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">java.util.Vector&lt;&hellip;&gt;</code></li>   </ul><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">如果某个字段声明为 List，则数据存储区返回的对象将具有 ArrayList 值。如果某个字段声明为 Set，则数据存储区返回 HashSet。如果某个字段声明为 SortedSet，则数据存储区返回 TreeSet。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">&nbsp;</p><h2 id="Object_Fields_and_Entity_Properties">对象字段和实体属性</h2><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">App Engine 数据存储区区分不具有指定属性的实体和该属性值为&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">null</code>&nbsp;的实体。JDO 不支持这种区分：对象的每个字段都有一个值，可能是&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">null</code>。如果将某个具有可设为 null 的值类型（不同于&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">int</code>&nbsp;或&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">boolean</code>&nbsp;之类的内置类型）的字段设置为&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">null</code>，则在保存对象时，所得实体会将该属性设置为 null 值。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">如果将一个数据存储区实体载入对象中，对于该对象中的某一个字段，实体中没有对应的属性，且该字段是可设为 null 的单值类型，则该字段将设置为&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">null</code>。在将该对象保存回数据存储区时，<code style="font-family: monospace; color: #007000; font-size: 10pt;">null</code>&nbsp;属性将在数据存储区中被设置为 null 值。如果该字段不是可设为 null 的值类型，则载入没有对应属性的实体将引发异常。如果实体是从用于重新创建实例的相同的 JDO 类创建的，则这种情况不会发生，但是如果 JDO 类发生变化，或者实体是使用低级别 API 而非 JDO 创建的，则会出现这种情况。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">如果某个字段的类型是核心数据类型的集合或 Serializable 类，而实体上的属性没有值，则会在数据存储区中将该属性设置为单一 null 值来表示该空集合。如果该字段的类型是数组类型，则会为其分配 0 个元素的数组。如果已载入对象而属性没有值，则将为该字段分配相应类型的空集合。在内部，数据存储区已知空集合与包含一个 null 值的集合之间的区别。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">如果实体具有一个在对象中没有对应字段的属性，则无法从该对象访问该属性。如果将对象保存回数据存储区，将删除这个额外的属性。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">如果某个实体具有一个值类型与对象中对应字段的类型不同的属性，则 JDO 会尝试将该值转换成字段类型。如果无法将该值转换成字段类型，则 JDO 将引发 ClassCastException。在值为数字（长整型或双精度浮点型）的情况下，将对该值进行转换 (convert)，而不是对类型进行转换 (cast)。如果数字属性值超出字段类型的表示范围，则转换将溢出，而不会引发异常。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">&nbsp;</p><h1 class="page_title">创建、获取和删除数据</h1><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">将 JDO 数据对象保存到数据存储区只需调用 PersistenceManager 实例的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">makePersistent()</code>&nbsp;方法。App Engine JDO 实现使用对象的主键字段来跟踪哪个数据存储区实体与该数据对象对应，并可以为新对象自动生成键。您可以使用键快速地检索实体，并从已知值（例如帐户 ID）构造键。</p>   <ul style="margin-top: 0.5em; margin-right: 0px; margin-bottom: 0px; margin-left: 15px; line-height: 16px; padding: 0px;">    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/creatinggettinganddeletingdata.html#Making_Objects_Persistent">使对象持久</a></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/creatinggettinganddeletingdata.html#Keys">键</a></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/creatinggettinganddeletingdata.html#Creating_and_Using_Keys">创建和使用键</a></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/creatinggettinganddeletingdata.html#Getting_an_Object_By_Key">通过键获取对象</a></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/creatinggettinganddeletingdata.html#Updating_an_Object">更新对象</a></li>    <li style="margin-top: 0.3em; margin-right: 0px; margin-bottom: 0px; margin-left: 1.5em; padding: 0px;"><a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/creatinggettinganddeletingdata.html#Deleting_an_Object">删除对象</a></li>   </ul><h2 id="Making_Objects_Persistent">使对象持久</h2><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">要将简单数据对象存储到数据存储区中，您可以调用 PersistenceManager 的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">makePersistent()</code>&nbsp;方法，将实例传递给该方法。</p><pre class="prettyprint"><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ" style="color: #660066;">PersistenceManager</span><span class="pln" style="color: #000000;"> pm </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> PMF</span><span class="pun" style="color: #666600;">.</span><span class="kwd" style="color: #000088;">get</span><span class="pun" style="color: #666600;">().</span><span class="pln" style="color: #000000;">getPersistenceManager</span><span class="pun" style="color: #666600;">();</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ" style="color: #660066;">Employee</span><span class="pln" style="color: #000000;"> e </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="kwd" style="color: #000088;">new</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">Employee</span><span class="pun" style="color: #666600;">(</span><span class="str" style="color: #008800;">&quot;Alfred&quot;</span><span class="pun" style="color: #666600;">,</span><span class="pln" style="color: #000000;"> </span><span class="str" style="color: #008800;">&quot;Smith&quot;</span><span class="pun" style="color: #666600;">,</span><span class="pln" style="color: #000000;"> </span><span class="kwd" style="color: #000088;">new</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">Date</span><span class="pun" style="color: #666600;">());</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">try</span><span class="pln" style="color: #000000;"> </span><span class="pun" style="color: #666600;">{</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pm</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">makePersistent</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">e</span><span class="pun" style="color: #666600;">);</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun" style="color: #666600;">}</span><span class="pln" style="color: #000000;"> </span><span class="kwd" style="color: #000088;">finally</span><span class="pln" style="color: #000000;"> </span><span class="pun" style="color: #666600;">{</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pm</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">close</span><span class="pun" style="color: #666600;">();</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun" style="color: #666600;">}</span></pre><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">对&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">makePersistent()</code>&nbsp;的调用是同步的，直到保存对象并更新索引后才会返回。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">要在 JDO 中保存多个对象，请对一组对象调用&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">makePersistentAll(&hellip;)</code>&nbsp;方法。在目前的版本中，该方法的实现类似对<code style="font-family: monospace; color: #007000; font-size: 10pt;">makePersistent()</code>&nbsp;的一系列调用。在未来的版本中，该方法将对数据存储区执行更高效的批量调用。</p><p class="note" style="padding-top: 0.2em; padding-right: 0.5em; padding-bottom: 0.2em; padding-left: 0.9em; margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 16px; background-color: #efefef; border-top-width: 1px; border-top-style: solid; border-bottom-width: 1px; border-bottom-style: solid; border-color: #bbbbbb;"><strong>注意：</strong>如果有任何数据对象的持久字段是对其他持久数据对象的引用，且任何这些对象自加载后从未保存过或已发生更改，则引用的对象也将保存到数据存储区。请参阅<a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/relationships.html">关系</a>。</p><h2 id="Keys">键</h2><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">每个实体都具有一个在 App Engine 的所有实体中唯一的键。一个完整的键包含若干条信息，其中包括应用程序 ID、类型和实体 ID。（键也包含有关实体组的信息，有关详细信息，请参阅<a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/transactions.html">事务</a>。）</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">对象的键存储在实例的某一个字段中。您可以使用&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">@PrimaryKey</code>&nbsp;批注来标识主键字段。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">应用程序可在创建对象时以字符串形式提供键的 ID 部分，也可以允许数据存储区自动生成数字 ID。完整的键在数据存储区的所有实体中必须是唯一的。换句话说，在类型相同且具有相同父实体组（如果有）的所有对象中，一个对象必须具有唯一的 ID。您可以使用字段类型和批注来选择所需的键的行为。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">如果类用作关系中的“子”类，则键字段必须为能够代表父实体组的类型：Key 实例或编码为字符串的键值。有关实体组的详细信息，请参阅<a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/transactions.html">事务</a>；有关关系的详细信息，请参阅<a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/relationships.html">关系</a>。</p><p class="note" style="padding-top: 0.2em; padding-right: 0.5em; padding-bottom: 0.2em; padding-left: 0.9em; margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; line-height: 16px; background-color: #efefef; border-top-width: 1px; border-top-style: solid; border-bottom-width: 1px; border-bottom-style: solid; border-color: #bbbbbb;"><strong>提示：</strong>如果应用程序创建一个新对象，并为其指定了与类型相同（且具有相同父实体组）的另一对象相同的字符串 ID，则保存该新对象时将覆盖数据存储区中的另一对象。要在创建新对象前检测字符串 ID 是否已经被使用，您可以使用事务尝试获取具有指定 ID 的实体，如果该实体不存在，则您可以继续创建。请参阅<a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/transactions.html">事务</a>。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">主键字段有 4 种类型：</p>   <dl style="line-height: 16px; padding: 0px; margin: 0px;">    <dt style="font-weight: bold; margin-top: 0.75em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding: 0px;">     长整型    </dt>    <dd style="margin-top: 0.4em; margin-right: 0px; margin-bottom: 0px; margin-left: 2em; font-weight: normal; padding: 0px;">     <p style="padding-top: 0.5em; padding-right: 0px; padding-bottom: 0.6em; padding-left: 0px; line-height: 16px; margin: 0px;">长整型 (<code style="font-family: monospace; color: #007000; font-size: 10pt;">java.lang.Long</code>)：由数据存储区自动生成的实体 ID。对于没有父实体组、其 ID 应由数据存储区自动生成的对象，请使用此类型。实例的长整型键字段在该实例保存时填充。</p>     <pre class="prettyprint"><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">IdGeneratorStrategy</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Persistent</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">PrimaryKey</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="com" style="color: #880000;">// &hellip;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@PrimaryKey</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@Persistent</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">valueStrategy </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">IdGeneratorStrategy</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">IDENTITY</span><span class="pun" style="color: #666600;">)</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">Long</span><span class="pln" style="color: #000000;"> id</span><span class="pun" style="color: #666600;">;</span></pre>    </dd>    <dt style="font-weight: bold; margin-top: 0.75em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding: 0px;">     未编码字符串    </dt>    <dd style="margin-top: 0.4em; margin-right: 0px; margin-bottom: 0px; margin-left: 2em; font-weight: normal; padding: 0px;">     <p style="padding-top: 0.5em; padding-right: 0px; padding-bottom: 0.6em; padding-left: 0px; line-height: 16px; margin: 0px;">一个字符串 (<code style="font-family: monospace; color: #007000; font-size: 10pt;">java.lang.String</code>)：对象创建时由应用程序提供的实体 ID（“键名”）。对于没有父实体组、其 ID 应由应用程序提供的对象，请使用此类型。应用程序在保存前将此域设置为所需的 ID。</p>     <pre class="prettyprint"><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">PrimaryKey</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="com" style="color: #880000;">// &hellip;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@PrimaryKey</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">String</span><span class="pln" style="color: #000000;"> name</span><span class="pun" style="color: #666600;">;</span></pre>    </dd>    <dt style="font-weight: bold; margin-top: 0.75em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding: 0px;">     键    </dt>    <dd style="margin-top: 0.4em; margin-right: 0px; margin-bottom: 0px; margin-left: 2em; font-weight: normal; padding: 0px;">     <p style="padding-top: 0.5em; padding-right: 0px; padding-bottom: 0.6em; padding-left: 0px; line-height: 16px; margin: 0px;">Key 实例 (<code style="font-family: monospace; color: #007000; font-size: 10pt;">com.google.appengine.api.datastore.Key</code>)。键值包括父实体组（如果有）的键以及应用程序分配的字符串 ID 或系统生成的数字 ID。要创建带应用程序分配的字符串 ID 的对象，请创建带有该 ID 的键值并将字段设置为该值。要创建带系统分配的数字 ID 的对象，请将键字段留为 null。有关如何使用父实体组的信息，请参阅<a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/transactions.html">事务</a>。</p>     <pre class="prettyprint"><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">IdGeneratorStrategy</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Persistent</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">PrimaryKey</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> com</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">google</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">appengine</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">api</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">datastore</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Key</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="com" style="color: #880000;">// &hellip;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@PrimaryKey</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@Persistent</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">valueStrategy </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">IdGeneratorStrategy</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">IDENTITY</span><span class="pun" style="color: #666600;">)</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">Key</span><span class="pln" style="color: #000000;"> key</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">public</span><span class="pln" style="color: #000000;"> </span><span class="kwd" style="color: #000088;">void</span><span class="pln" style="color: #000000;"> setKey</span><span class="pun" style="color: #666600;">(</span><span class="typ" style="color: #660066;">Key</span><span class="pln" style="color: #000000;"> key</span><span class="pun" style="color: #666600;">)</span><span class="pln" style="color: #000000;"> </span><span class="pun" style="color: #666600;">{</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">this</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">key </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> key</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="pun" style="color: #666600;">}</span></pre>     <p style="padding-top: 0.5em; padding-right: 0px; padding-bottom: 0.6em; padding-left: 0px; line-height: 16px; margin: 0px;">应用程序可以使用 KeyFactory 类创建 Key 实例：</p>     <pre class="prettyprint"><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> com</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">google</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">appengine</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">api</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">datastore</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Key</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> com</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">google</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">appengine</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">api</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">datastore</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">KeyFactory</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="com" style="color: #880000;">// &hellip;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ" style="color: #660066;">Key</span><span class="pln" style="color: #000000;"> key </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">KeyFactory</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">createKey</span><span class="pun" style="color: #666600;">(</span><span class="typ" style="color: #660066;">Employee</span><span class="pun" style="color: #666600;">.</span><span class="kwd" style="color: #000088;">class</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">getSimpleName</span><span class="pun" style="color: #666600;">(),</span><span class="pln" style="color: #000000;"> </span><span class="str" style="color: #008800;">&quot;Alfred.Smith@example.com&quot;</span><span class="pun" style="color: #666600;">);</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ" style="color: #660066;">Employee</span><span class="pln" style="color: #000000;"> e </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="kwd" style="color: #000088;">new</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">Employee</span><span class="pun" style="color: #666600;">();</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; e</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">setKey</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">key</span><span class="pun" style="color: #666600;">);</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; pm</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">makePersistent</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">e</span><span class="pun" style="color: #666600;">);</span></pre>    </dd>    <dt style="font-weight: bold; margin-top: 0.75em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding: 0px;">     编码字符串形式的键    </dt>    <dd style="margin-top: 0.4em; margin-right: 0px; margin-bottom: 0px; margin-left: 2em; font-weight: normal; padding: 0px;">     <p style="padding-top: 0.5em; padding-right: 0px; padding-bottom: 0.6em; padding-left: 0px; line-height: 16px; margin: 0px;">与键类似，但值是键的编码字符串形式。编码字符串键允许您以便携方式编写应用程序且仍可以利用 App Engine 数据存储区实体组。</p>     <pre class="prettyprint"><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Extension</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">IdGeneratorStrategy</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Persistent</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> javax</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">jdo</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">annotations</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">PrimaryKey</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> com</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">google</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">appengine</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">api</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">datastore</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Key</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="com" style="color: #880000;">// &hellip;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@PrimaryKey</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@Persistent</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">valueStrategy </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">IdGeneratorStrategy</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">IDENTITY</span><span class="pun" style="color: #666600;">)</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@Extension</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">vendorName</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;datanucleus&quot;</span><span class="pun" style="color: #666600;">,</span><span class="pln" style="color: #000000;"> key</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;gae.encoded-pk&quot;</span><span class="pun" style="color: #666600;">,</span><span class="pln" style="color: #000000;"> value</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;true&quot;</span><span class="pun" style="color: #666600;">)</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">String</span><span class="pln" style="color: #000000;"> encodedKey</span><span class="pun" style="color: #666600;">;</span></pre>     <p style="padding-top: 0.5em; padding-right: 0px; padding-bottom: 0.6em; padding-left: 0px; line-height: 16px; margin: 0px;">应用程序可以在保存前使用带名称的键填充该值，或将它留为 null。如果编码的键字段为 null，则将在保存对象时使用系统生成的键填充该字段。</p>     <p style="padding-top: 0.5em; padding-right: 0px; padding-bottom: 0.6em; padding-left: 0px; line-height: 16px; margin: 0px;">Key 实例和编码字符串表示可以通过 KeyFactory 方法&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">keyToString()</code>&nbsp;和&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">stringToKey()</code>&nbsp;进行相互转换。</p>     <p style="padding-top: 0.5em; padding-right: 0px; padding-bottom: 0.6em; padding-left: 0px; line-height: 16px; margin: 0px;">当使用编码键字符串时，您可以通过一个额外的字段提供对对象的字符串 ID 或数字 ID 的访问：</p>     <pre class="prettyprint"><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@PrimaryKey</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@Persistent</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">valueStrategy </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">IdGeneratorStrategy</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">IDENTITY</span><span class="pun" style="color: #666600;">)</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@Extension</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">vendorName</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;datanucleus&quot;</span><span class="pun" style="color: #666600;">,</span><span class="pln" style="color: #000000;"> key</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;gae.encoded-pk&quot;</span><span class="pun" style="color: #666600;">,</span><span class="pln" style="color: #000000;"> value</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;true&quot;</span><span class="pun" style="color: #666600;">)</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">String</span><span class="pln" style="color: #000000;"> encodedKey</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@Extension</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">vendorName</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;datanucleus&quot;</span><span class="pun" style="color: #666600;">,</span><span class="pln" style="color: #000000;"> key</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;gae.pk-name&quot;</span><span class="pun" style="color: #666600;">,</span><span class="pln" style="color: #000000;"> value</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;true&quot;</span><span class="pun" style="color: #666600;">)</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">String</span><span class="pln" style="color: #000000;"> keyName</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="com" style="color: #880000;">// OR:</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="lit" style="color: #006666;">@Extension</span><span class="pun" style="color: #666600;">(</span><span class="pln" style="color: #000000;">vendorName</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;datanucleus&quot;</span><span class="pun" style="color: #666600;">,</span><span class="pln" style="color: #000000;"> key</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;gae.pk-id&quot;</span><span class="pun" style="color: #666600;">,</span><span class="pln" style="color: #000000;"> value</span><span class="pun" style="color: #666600;">=</span><span class="str" style="color: #008800;">&quot;true&quot;</span><span class="pun" style="color: #666600;">)</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; </span><span class="kwd" style="color: #000088;">private</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">Long</span><span class="pln" style="color: #000000;"> keyId</span><span class="pun" style="color: #666600;">;</span></pre>     <p style="padding-top: 0.5em; padding-right: 0px; padding-bottom: 0.6em; padding-left: 0px; line-height: 16px; margin: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">&quot;gae.pk-name&quot;</code>&nbsp;字段可以在保存对象前设置为键名称。保存对象时，将使用包括键名称的完整键填充编码键字段。其类型必须为 String。</p>     <p style="padding-top: 0.5em; padding-right: 0px; padding-bottom: 0.6em; padding-left: 0px; line-height: 16px; margin: 0px;"><code style="font-family: monospace; color: #007000; font-size: 10pt;">&quot;gae.pk-id&quot;</code>&nbsp;字段在对象保存时填充，且无法修改。其类型必须为 Long。</p>    </dd>   </dl><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">创建带生成的键（使用&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">valueStrategy = IdGeneratorStrategy.IDENTITY</code>&nbsp;的键字段）的新对象时，其键值初始为&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">null</code>。键字段在对象写入数据存储区时填充。如果使用事务，则对象在事务提交时写入。否则，如果创建对象，则对象在调用&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">makePersistent()</code>&nbsp;方法时写入；如果更新对象，则对象在调用 PersistenceManager 实例的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">close()</code>&nbsp;方法时写入。</p><h2 id="Creating_and_Using_Keys">创建和使用键</h2><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">如果应用程序已知实体的完整键的所有元素，则应用程序可以在没有对象的情况下创建对应的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">Key</code>&nbsp;对象。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">对于没有父实体组的实体的键，您可以使用&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">KeyFactory</code>&nbsp;类的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">createKey()</code>&nbsp;静态方法。该方法采用类型（类的简单名称）和应用程序分配的字符串 ID 或系统分配的数字 ID，并返回&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">Key</code>&nbsp;对象。例如，要重新创建键名称为&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">&quot;Alfred.Smith@example.com&quot;</code>&nbsp;的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">&quot;Employee&quot;</code>&nbsp;类型的实体的键（无父实体组）：</p><pre class="prettyprint"><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> com</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">google</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">appengine</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">api</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">datastore</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Key</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> com</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">google</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">appengine</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">api</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">datastore</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">KeyFactory</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="com" style="color: #880000;">// &hellip;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ" style="color: #660066;">Key</span><span class="pln" style="color: #000000;"> k </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">KeyFactory</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">createKey</span><span class="pun" style="color: #666600;">(</span><span class="typ" style="color: #660066;">Employee</span><span class="pun" style="color: #666600;">.</span><span class="kwd" style="color: #000088;">class</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">getSimpleName</span><span class="pun" style="color: #666600;">(),</span><span class="pln" style="color: #000000;"> </span><span class="str" style="color: #008800;">&quot;Alfred.Smith@example.com&quot;</span><span class="pun" style="color: #666600;">);</span></pre><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">要重新创建系统分配的数字 ID 为&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">52234</code>&nbsp;的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">&quot;Employee&quot;</code>&nbsp;类型的实体的键（无父实体组）：</p><pre class="prettyprint"><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ" style="color: #660066;">Key</span><span class="pln" style="color: #000000;"> k </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">KeyFactory</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">createKey</span><span class="pun" style="color: #666600;">(</span><span class="typ" style="color: #660066;">Employee</span><span class="pun" style="color: #666600;">.</span><span class="kwd" style="color: #000088;">class</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">getSimpleName</span><span class="pun" style="color: #666600;">(),</span><span class="pln" style="color: #000000;"> </span><span class="lit" style="color: #006666;">52234</span><span class="pun" style="color: #666600;">);</span></pre><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">可以使用 KeyFactory 类的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">keyToString()</code>&nbsp;方法将键转换为字符串表示，使用&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">stringToKey()</code>&nbsp;方法将字符串表示转换为键。（请注意，这与 Key 类的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">toString()</code>&nbsp;方法不同，该方法返回适用于调试的用户可读的值。）</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">对于具有父实体组的实体的键，您可以使用 KeyFactory.Builder 类：</p><pre class="prettyprint"><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> com</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">google</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">appengine</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">api</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">datastore</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Key</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="kwd" style="color: #000088;">import</span><span class="pln" style="color: #000000;"> com</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">google</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">appengine</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">api</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">datastore</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">KeyFactory</span><span class="pun" style="color: #666600;">;</span><span class="pln" style="color: #000000;"></span><span class="com" style="color: #880000;">// &hellip;</span><span class="pln" style="color: #000000;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ" style="color: #660066;">Key</span><span class="pln" style="color: #000000;"> k </span><span class="pun" style="color: #666600;">=</span><span class="pln" style="color: #000000;"> </span><span class="kwd" style="color: #000088;">new</span><span class="pln" style="color: #000000;"> </span><span class="typ" style="color: #660066;">KeyFactory</span><span class="pun" style="color: #666600;">.</span><span class="typ" style="color: #660066;">Builder</span><span class="pun" style="color: #666600;">(</span><span class="typ" style="color: #660066;">Employee</span><span class="pun" style="color: #666600;">.</span><span class="kwd" style="color: #000088;">class</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">getSimpleName</span><span class="pun" style="color: #666600;">(),</span><span class="pln" style="color: #000000;"> </span><span class="lit" style="color: #006666;">52234</span><span class="pun" style="color: #666600;">).</span><span class="pln" style="color: #000000;">addChild</span><span class="pun" style="color: #666600;">(</span><span class="typ" style="color: #660066;">ExpenseReport</span><span class="pun" style="color: #666600;">.</span><span class="kwd" style="color: #000088;">class</span><span class="pun" style="color: #666600;">.</span><span class="pln" style="color: #000000;">getSimpleName</span><span class="pun" style="color: #666600;">(),</span><span class="pln" style="color: #000000;"> </span><span class="str" style="color: #008800;">&quot;A23Z79&quot;</span><span class="pun" style="color: #666600;">).</span><span class="pln" style="color: #000000;">getKey</span><span class="pun" style="color: #666600;">();</span></pre><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">Builder 实例的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">addChild()</code>&nbsp;方法返回 Builder，因此您可以连锁调用以添加键路径的每一个元素。要获取指定 Builder 的完整键值，您可以调用该 Builder 的&nbsp;<code style="font-family: monospace; color: #007000; font-size: 10pt;">getKey()</code>&nbsp;方法。</p><p style="padding-top: 1em; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; line-height: 16px; margin: 0px;">有关实体组的详细信息，请参阅<a style="color: #0000cc;" href="http://code.google.com/intl/zh-CN/appengine/docs/java/datastore/transactions.html">事务</a>。</p><h2 id="Getting_an_Object_By_Key"><br /></h2></span></span></pre></p>

    <hr>
    <div class="pagination">
      <ul>
        <ul>
          
            <li class="prev"><a href="/2011/78.html" title="电脑报警音">&larr; Previous</a></li>
          
          

            <li><a href="/archive">Archive</a></li>

          
            <li class="next"><a href="/2011/69.html" title="junit 4.4测试">Next &rarr;</a></li>
          
          
        </ul>
      </ul>
    </div>
    <hr>
     
  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>2011-01-19</span></div>
    <br>
    <h4>Share to Weixin</h4>
    <div id="share-qrcode"></div>
    <script type="text/javascript">
      new QRCode(document.getElementById("share-qrcode"), {
        text:document.URL,
        width:128,
        height:128
      });
    </script>
    <br>
    <h4>Categories</h4>
    <ul class="tag_box">
    
      <li>
  <a href="/categories/#default-ref">default <span>108</span></a>
</li>
    
    </ul>
    <br>
    <h4>Tags</h4>
    <ul class="tag_box">
    
    </ul>
  </div>
</div>

      <footer>
        <p>&copy; 盒子 2016
          with help from <a href="http://github.com/wendal/gor" target="_blank" title="Gor -- Fast Blog">Gor</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
		  and Idea from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
            <a href="http://www.miitbeian.gov.cn" target="_blank">京ICP备17040577号-1</a> 
        </p>
        <p><a href="/info.html" target="_blank">网络监控</a></p>
      </footer>
    </div> <!-- /container -->
  </body>
</html>
